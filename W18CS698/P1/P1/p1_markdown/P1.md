### Experiment on Ruler vibration a simple harmonic model

In physics, the vibration of a ruler with one end attached to a stationary surface is experiment to obverse the basics of waves. Due to the simplicity of this experiment, I decided to simulate the sound wave generated by this.

Ruler vibrating generates a simple harmonic wave that only the first few harmonics are needed. From physics experiments, the relation between the foundamentale frequency and the length of the ruler away from the surface and defined by.

$$ f = cl^n $$

Where $f$ is the frequency, $l$ is the length and $c,n$ are constants. I decided to measure the two constants of my ruler so that I can compare the results from simulation and real sound.

![ruler.jpg](./resources/ED8CB5C689ADFB5566AA1C4A50EDD70D.jpg =403x302)

I used an application on my phone called *Spectroid* that gives me a real time view of the spectrum of sound. I performed different measurements at different length of the ruler.

| ![8cm85hz.png](./resources/0303A758F96D487909335A80EC9391C6.png =270x540)| ![10cm56hz.png](./resources/1AD197602C225B64D78EF358566A8EA2.png =270x540) |
|-:|-:|


| length (cm) | frequency (hz) |
| --: | --: |
| 6 | 150|
| 7 | 108 |
| 8 | 85 |
|9 | 70|
| 10 | 56|

So I took 2 rows to solve the equations:

$$\begin{align*}
& 85 = c (0.08)^n \\
& 56 = c (0.1)^n
\end{align*}$$

Solving the set of equations would give $n = -187009, c = 0.75526$

Then I looked at the specturm of length 8 cm with *Audacity* to get the level of sound intensity at each harmonic and took the first 4 harmonics's sound intensity to have a rough model for the simulation.

| harmonic | intensity (db)|
| --: | --:|
|1| -29|
| 2 | -54|
| 3| -60|
| 4 | -63|

I fit this meassurement with exponiental function by `scipy.optimize` and achieved a rough function.

$$ 0.24606e^{-1.9368k}$$

Where $k$ is the harmonic number.

From observation of the spectrum, the sound intensity have a linear decay over logrithm function. However, at higher frequencies is have some unusual behavior. My assumption is that it's the noise from the fact that I can't keep the ruler 100% stable at the table so there are some noises created by that. Also, there are sound when my fingers are leaving the ruler.

#### Creating a simulation prototype

##### Setting up the simulation environment
Now I need to create a simulation to show that I can generate a sound base on the previous experiment. Also, I need to explore softwares that can have sound control at a lower level.

After some research online here are the tools I used for the ruler simulation and hopefully it still serves great for the final project.

Software used:
- [Python 3](https://www.python.org/)
    Python is a simple high level programming language with great extensions. I choose python because I'm familiar with it and python can be installed on every system extremely easy.
- [sounddevice](https://python-sounddevice.readthedocs.io/en/0.3.10/#)
    A python sound package that can directly play numpy arrays and have very low level control of sound streams
- [numpy](http://www.numpy.org/)
    Scientific computing toolkit.
- [scipy](https://www.scipy.org/)
    Scientific computing toolkit
- [pyglet](https://bitbucket.org/pyglet/pyglet/wiki/Home)
    Great simple python multimedia library.

All the packages can be simply installed with `pip`. `pip3 install numpy scipy pyglet sounddevice`

##### Setting up the sound pipline
I created a function that would produce a sound array based on 2 values, the length of the ruler and the "force" applied. The "force" is a simple parameter that changes the sound level.

Inorder to have a sound playing and can add more sound simutaneously, I discovered that `sounddevice` have low level sound interface to have streams of sound directly modified. So by creating a stream with each interaction that would create a sound, I can have them independently controlled. This hopefully will elimiate problems about sound modification problem in the future.

##### Some failure attempts
###### Sound updating base on timesteps
At first I have a thought that I can have all the sound arrays stored. Then at a fixed time step $dt$ I would update the stream so it could play the sound for the next time step. However, later I discovered when doing so, I have no control on the accuracy of the time steps. So as a result I would get discontinued sound, which is super bad.
###### Use high level audio playback function calls
At first, I called audio play functions with threading. However, that creates some interesting problems that I think might be system specific. The second audio played would be overwrite the first audio played. It seems to me that the function call access a single audio interface on system level and would simply overwrite it. It might also be due to the package I'm using but it's good to put a note here.


#### The simulation
The file `p1.py` opens a blacked screen window with fps displayed on the bottom left. When clicking in the window a sound will be played based on the location clicked.

- Ruler length: 5cm at left and 12 cm at right.
- Sound level: 0.2 at bottom and 1.2 at top.

For example, clicking at top right cornor will generate a simulated sound from a ruler 12 cm away from table with high sound level and at bottom right cornor will generate a simulated sound from a ruler 5 cm away from table with low sound level.

To quit the simulation press `esc`.

##### Observations of simulation result
At longer ruler length, the sound sounds very legit. However, at shorter ruler length, the sound does not sound right. My guess is that in real life, at shorter length, it's very hard to have the ruler proper bent and produce a simple harmonic motion. Also, as discuss before, it's very hard to eliminate the noise created by can't have one end of the ruler exactly stationary.

#### Summary
Currently I have a working simulation system with every part tested. (There's no graphics for the current simulation due to it's not important in my oppinion. But I've used `pyglet` to create other simulations in the past, so I have that part covered) To complete the final project, I need to figure out how to apply the equations from the papers to real world materials so I can model the sound generation of ball colliding and ball plate colliding.
